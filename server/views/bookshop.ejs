
<!-- CAROUSEL START -->
<div class="md:my-18 md:mx-8 ">
  
  <!-- CAROUSEL ITEM 1 START -->
  <div class=" md:bg-linear-to-bl from-primary to-accent md:relative">

    <div class="md:p-6 md:bg-black/80 md:relative w-full h-full">
            <div class="md:grid md:grid-cols-7 md:gap-8 w-full">
        
      <div class="md:col-span-3 md:h-full md:bg-primary/0 md:px-4 md:py-6 md:rounded-sm transition delay-150 duration-300 ease-in-out ">
       
        <!-- UNDER MAINTAINENCE SIGN -->
        <div class="hidden md:block">
          <h2 class="font-outfit font-bold text-white md:text-5xl/tight md:p-2">Discover a world of stories online</h2>
          <p class=" font-outfit font-light text-white md:py-1 md:px-2 md:mt-5 ">Find your dream book according to your preferences and join our family, What are you waiting for join us today</p>
        </div>
        
      </div>
      <img class="hidden md:block md:h-66 md:w-full" src="<%=data.books[1].img_url%>"></img>
      <img class=" hidden md:block md:h-66 md:w-full" src="<%=data.books[2].img_url%>"></img>
      <img class=" hidden md:block md:h-66 md:w-full" src="<%=data.books[10].img_url%>"></img>
      <img class=" hidden md:block md:h-66 md:w-full" src="<%=data.books[4].img_url%>"></img>
      <img class=" hidden md:block md:h-66 md:w-full" src="<%=data.books[5].img_url%>"></img>
      <img class=" hidden md:block md:h-66 md:w-full " src="<%=data.books[6].img_url%>"></img>
      <img class=" hidden md:block md:h-66 md:w-full" src="<%=data.books[7].img_url%>"></img>
      <img class=" hidden md:block md:h-66 md:w-full " src="<%=data.books[8].img_url%>"></img>
      <img class=" hidden md:block md:h-66 md:w-full" src="<%=data.books[9].img_url%>"></img>
      <img class=" hidden md:block md:h-66 md:w-full " src="<%=data.books[11].img_url%>"></img>
      <img class=" hidden md:block md:h-66 md:w-full" src="<%=data.books[12].img_url%>"></img>

      <!-- <div class="col-span-2 h-66 bg-white/30 px-4 py-4 rounded-sm self-start">
         <h2 class="font-poppins font-bold text-4xl text-white ">Best Book Cover Art</h2>
      </div> -->
        
    </div>
    </div>

  </div> 
  <!-- CAROUSEL ITEM 1 END -->

  <!-- CAROUSEL INDICATORS -->
  <!-- <div class="w-full justify-center flex flex-row mt-10 gap-2">
    <div class="bg-primary h-5 w-5 rounded-[50%] border-1 border-slate-600"></div>
    <div class="h-5 w-5 rounded-[50%] border-1 border-slate-600"></div>
    <div class="h-5 w-5 rounded-[50%] border-1 border-slate-600"></div>
    <div class="h-5 w-5 rounded-[50%] border-1 border-slate-600"></div>
  </div>  -->
  <!-- CAROUSEL INDICATORS END -->

</div> 
<!-- CAROUSEL END -->


<!-- RECOMMENDED TITLES SECTION START -->
<div class="w-full px-6 mb-18">
  <div class="flex flex-row w-full justify-between px-2 mt-12 md:mt-0">
    <h2 class="font-bold font-outfit text-xl ">Recommended Titles</h2>
    <div class="flex">
      <span class="font-light font-outfit">
         <span class="hidden md:block">Rows per page: </span>
         <span class="md:hidden">See All</span>
      </span>
      <select name="rt_rows_per_page" id="" class="hidden md:block md:w-10 md:mx-4">
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
          </select>
     </div>
  </div> 
  

  <!-- SEARCH BAR START -->
   <div class="hidden md:block md:h-14 md:bg-white md:rounded-md md:mt-8 md:px-2 md:mx-1 md:flex md:flex-row md:gap-4 md:items-center"> 
      <div class="border-r border-gray-300 h-full flex px-2 ">
          <select name="filter_opts" id="">
              <option value="default"> Advanced Filter</option>
              <option value="book_nm">Titles</option>
              <option value="author">Author</option>
              <option value="genre">Genre</option>
          </select>
      </div>
      <div class="w-full">
        <input id="recommeded_titles_af" type="text" placeholder="Search for books, authors, genres and  etc ..." class="w-full font-outfit text-gray-400">
      </div>
   </div> 
   <!-- SEARCH BAR END -->


  <!-- DATA TABLE START -->
  <table id="recommended-table" class="hidden cards md:block">
    <thead class="hidden">
      <tr>
        <th>Image</th>
        <th>Title</th>
        <th>Borrow Button</th>
        <th>Ratings</th>
      </tr>
    </thead>
    <tbody>
      <% data.books.forEach(book => { %>
        <tr id="<%=book.book_id%>" class="group">
          <td><img src="<%=book.img_url%>" alt=""></td>
          <td><span><%= book.book_nm %></span></td>
          <td> <div class=" flex flex-row justify-start"> <button class="nav-btn-2 w-40 bg-accent text-white" onclick="alert('Function to be implemented')">Borrow now</button> </div> </td> 
          <td> <div class="ratings" data-rating-id="<%=book.book_id%>" data-rating-score="<%=book.rating_score ?? 0 %>"></div> </td>    
        </tr>
      <% }) %>
    </tbody>
  </table> 
  <!-- DATA TABLE END -->

  <!-- MOBILE MAINTAINENCE BLOCK -->
   <div class="mt-10 md:hidden">
      <h2 class="text-center font-outfit font-bold ">MOBILE VIEW IS CURRENTLY BEING DEVELOPED</h2>
   </div>

</div> 
<!-- RECOMMENDED TITLES SECTION END -->




<!-- New Releases 
<div class="w-full px-6 mb-18">
  <div class="flex flex-row w-full justify-between px-2">
    <h2 class="font-bold font-outfit text-xl ">New Releases</h2>
    <div>
      <span class="font-light font-outfit">Rows per page: </span>
      <input type="number" value="5">
     </div>
  </div>
   <div class="h-14 bg-white rounded-md mt-8 px-2 mx-1 "> Search for books,authors,genres and etc..</div>

  <table id="new-releases" class="cards">
    <thead class="hidden">
      <tr>
        <th>Image</th>
        <th>Title</th>
        <th>Borrow Button</th>
        <th>Ratings</th>
      </tr>
    </thead>
    <tbody>
      <% data.books.forEach(book => { %>
        <tr class="group">
          <td><img src="<%=book.img_url%>" alt=""></td>
          <td><span><%= book.book_nm %></span></td>
          <td> <div class=" flex flex-row justify-start"> <button class="nav-btn-2 w-40 bg-accent text-white">Borrow now</button> </div> </td>
          <td><div id="ratings">stars</div> </td>
                
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>
-->


 <!-- <div class="h-full w-full flex flex-row gap-4 items-center my-8 overflow-x-auto pb-5 md:justify-between md:mb-12">
          <% if (data.books.length) { %>
            <% data.books.forEach(book => { %>
                <% if (book.categories.includes('bkcat_000005')) { %>
                    <div class="card-showcase group">
                      <div class="card-container">
                        <img class="card-img" src="<%=book.img_url%>" ></img>
                      </div>
                      <p class="book-title"><%=book.book_nm%></p>
                      <div class="px-1 mt-4 flex flex-row justify-start">
                        <button class="nav-btn-2 w-[90%] bg-accent text-white">Borrow now</button>
                      </div>
                    </div>
                <%}%>
            <% }) %>
          <% }%>
</div> -->


<script>

  const recommededTitlesAdvancedFilter = document.getElementById("recommeded_titles_af");

  function generateRatings(){
    const min = 1; // lowest Rating
    const max = 5; // highest Rating

    rating = Math.random() * (max - min) + min;

    return rating.toFixed(2);
  }

  function renderRatings(){
    const ratingElements = Array.from(document.querySelectorAll(".ratings"));

    ratingElements.forEach(elem => {

      const bookId = elem.getAttribute('data-rating-id')
      const ratingScore = elem.getAttribute('data-rating-score') == 0 ? generateRatings() : elem.getAttribute('data-rating-score') ; 

      console.log(`\nBook ID: ${bookId} \n Rating Score: ${ratingScore}`)

      if(ratingScore > 0 && ratingScore < 1.5){
        elem.innerHTML = `
          <div class="full-star"></div>
          <div class="empty-star"></div>
          <div class="empty-star"></div>
          <div class="empty-star"></div>
          <div class="empty-star"></div>
          `;
      }

      if(ratingScore >= 1.5 && ratingScore < 2.0){
        elem.innerHTML = `
          <div class="full-star"></div>
          <div class="half-star"></div>
          <div class="empty-star"></div>
          <div class="empty-star"></div>
          <div class="empty-star"></div>
          `;
      }

      if(ratingScore >= 2.0 && ratingScore < 2.5){
        elem.innerHTML = `
          <div class="full-star"></div>
          <div class="full-star"></div>
          <div class="empty-star"></div>
          <div class="empty-star"></div>
          <div class="empty-star"></div>
          `;
      }

      if(ratingScore >= 2.5 && ratingScore < 3.0){
        elem.innerHTML = `
          <div class="full-star"></div>
          <div class="full-star"></div>
          <div class="half-star"></div>
          <div class="empty-star"></div>
          <div class="empty-star"></div>
          `;
      }

      if(ratingScore >= 3.0 && ratingScore < 3.5){
        elem.innerHTML = `
          <div class="full-star"></div>
          <div class="full-star"></div>
          <div class="full-star"></div>
          <div class="empty-star"></div>
          <div class="empty-star"></div>
          `;
      }

       if(ratingScore >= 3.5 && ratingScore < 4.0){
        elem.innerHTML = `
          <div class="full-star"></div>
          <div class="full-star"></div>
          <div class="full-star"></div>
          <div class="half-star"></div>
          <div class="empty-star"></div>
          `;
      }

      if(ratingScore >= 4.0 && ratingScore < 4.5){
        elem.innerHTML = `
          <div class="full-star"></div>
          <div class="full-star"></div>
          <div class="full-star"></div>
          <div class="full-star"></div>
          <div class="empty-star"></div>
          `;
      }

      if(ratingScore >= 4.5 && ratingScore < 5.0){
        elem.innerHTML = `
          <div class="full-star"></div>
          <div class="full-star"></div>
          <div class="full-star"></div>
          <div class="full-star"></div>
          <div class="half-star"></div>
          `;
      }

      
      if(ratingScore == 5){
        elem.innerHTML = `
          <div class="full-star"></div>
          <div class="full-star"></div>
          <div class="full-star"></div>
          <div class="full-star"></div>
          <div class="empty-star"></div>
          `;
      }

    })


  }

  recommededTitlesAdvancedFilter.addEventListener("keydown", function(event) {
  // Check if the key pressed is "Enter"
  if (event.key === "Enter") {
    // Prevent the default action, if needed (e.g., form submission and page reload)
    event.preventDefault(); 
    // Trigger your function
    alert("Search feature to be implemented");
  }
  });
  
  
$(document).ready(function () {
  const tables = ['#recommended-table', '#new-releases'];

  renderRatings();
  

  tables.forEach((table) => {

    if(table)
    $(table).DataTable({
    paging: true,
    pageLength: 6, // Adjust number of cards per page
    searching: false,
    info: true,
    ordering: false,
    lengthChange: false,
    language: {
      paginate: {
        previous: "←",
        next: "→"
      }
    },
    drawCallback: function () {
      // Reapply Tailwind classes after redraw
      // $('#cardTable tbody').addClass('flex h-80 flex-wrap justify-between');
      // $('#cardTable tbody tr').addClass('bg-white h-full w-full shrink-0 md:h-66 md:w-46  md:rounded-md md:pb-2 ');
      // $('#cardTable tbody td').addClass('mb-1 font-outfit text-sm text-gray-700');
      // $('#cardTable tbody td img').addClass('card-img');
      // $('#cardTable tbody td div button').addClass('nav-btn-2 w-[90%] bg-accent text-white');
    }
  });
  })


  
});


</script>
